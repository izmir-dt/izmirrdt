import{h as U,i as O,r as n,a as Q,k as E,l as N,j as e,U as K,m as $,P as A,S as F,X as v,T as z}from"./index-BiS_08CB.js";import{I as V}from"./input-D4NQlLM0.js";import{S as P}from"./skeleton-CIwMLOW5.js";import{t as T}from"./theater-BlRsLV9p.js";import{L as B,C as G}from"./loader-circle-kQZmj9r2.js";const i="GÖREVLİ OLMAYAN",R=["Kişi","Kategori","Başlangıç","Bitiş","Açıklama"];function I(){const y=U(),{toast:x}=O(),[l,w]=n.useState(""),[k,o]=n.useState(!1),[d,g]=n.useState([]),[D,b]=n.useState(null),h=n.useRef([]),{data:c,isLoading:L,isFetching:M}=Q({queryKey:["/api/sheets",i],staleTime:3e4}),r=c?.headers?.length?c.headers:R,u=c?.rows??[],C=n.useMemo(()=>{if(!l.trim())return u;const s=T(l.trim());return u.filter(a=>a.some(t=>T(String(t??"")).includes(s)))},[u,l]),m=E({mutationFn:s=>N("POST",`/api/sheets/${encodeURIComponent(i)}/row`,{values:s}),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/sheets",i]}),o(!1),g(r.map(()=>"")),x({title:"Kayıt eklendi"})},onError:()=>x({title:"Hata",description:"Kayıt eklenemedi",variant:"destructive"})}),j=E({mutationFn:s=>N("DELETE",`/api/sheets/${encodeURIComponent(i)}/row/${s}`),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/sheets",i]}),b(null),x({title:"Kayıt silindi"})},onError:()=>x({title:"Hata",description:"Kayıt silinemedi",variant:"destructive"})}),q=n.useCallback(()=>{g(r.map(()=>"")),o(!0),setTimeout(()=>h.current[0]?.focus(),50)},[r]),p=n.useCallback(async()=>{if(!d.some(a=>a.trim())){o(!1);return}if(!c?.headers?.length)try{await N("POST",`/api/sheets/${encodeURIComponent(i)}/row`,{values:R})}catch{}m.mutate(d)},[d,m,c]),H=n.useCallback((s,a)=>{if(s.key==="Tab"){s.preventDefault();const t=s.shiftKey?a-1:a+1;t>=0&&t<r.length?h.current[t]?.focus():t>=r.length&&p()}s.key==="Enter"&&(a<r.length-1?h.current[a+1]?.focus():p()),s.key==="Escape"&&o(!1)},[r,p]);return L?e.jsxs("div",{className:"p-6 space-y-3 max-w-3xl",children:[e.jsx(P,{className:"h-9 w-full rounded-lg"}),[1,2,3,4,5].map(s=>e.jsx(P,{className:"h-12 rounded-lg"},s))]}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-b border-border",style:{background:"hsl(var(--card))"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4",style:{color:"hsl(var(--sidebar-primary))"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-[14px] text-foreground",children:"Müsait Personel"}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:[u.length," kayıt"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y.invalidateQueries({queryKey:["/api/sheets",i]}),className:"p-1.5 rounded-lg hover:bg-muted transition-colors text-muted-foreground",title:"Yenile",children:e.jsx($,{className:`w-3.5 h-3.5 ${M?"animate-spin":""}`})}),e.jsxs("button",{onClick:q,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[12px] font-semibold text-white transition-colors",style:{background:"hsl(var(--sidebar))"},children:[e.jsx(A,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--sidebar-primary))"}}),"Kişi Ekle"]})]})]}),e.jsx("div",{className:"shrink-0 px-4 py-2 border-b border-border",style:{background:"hsl(var(--card))"},children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(F,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(V,{placeholder:"Ara…",value:l,onChange:s=>w(s.target.value),className:"pl-8 pr-7 h-8 text-[12px]"}),l&&e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>w(""),children:e.jsx(v,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:r.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-muted-foreground gap-2",children:[e.jsx(K,{className:"w-10 h-10 opacity-20"}),e.jsx("p",{className:"text-sm font-medium",children:"Henüz veri yok"}),e.jsx("p",{className:"text-xs",children:'Kişi eklemek için "Kişi Ekle" butonunu kullanın'})]}):e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{style:{background:"hsl(var(--sidebar))"},children:[e.jsx("th",{className:"w-10 px-3 py-2.5 text-left text-[10px] font-bold tracking-wide text-muted-foreground",children:"#"}),r.map((s,a)=>e.jsx("th",{className:"px-3 py-2.5 text-left text-[10px] font-bold tracking-wide",style:{color:"hsl(var(--sidebar-foreground) / 0.7)"},children:s},a)),e.jsx("th",{className:"w-10 px-3 py-2.5"})]})}),e.jsxs("tbody",{children:[k&&e.jsxs("tr",{className:"border-b-2 border-primary/30 bg-primary/5",children:[e.jsx("td",{className:"px-3 py-2",children:m.isPending?e.jsx(B,{className:"w-3 h-3 animate-spin text-primary"}):e.jsx(A,{className:"w-3 h-3 text-primary"})}),r.map((s,a)=>e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{ref:t=>{h.current[a]=t},value:d[a]??"",onChange:t=>{const f=[...d];f[a]=t.target.value,g(f)},onKeyDown:t=>H(t,a),placeholder:s,disabled:m.isPending,className:"w-full min-w-[100px] h-8 px-2 rounded-md border border-primary/40 bg-background text-sm focus:outline-none focus:ring-1 focus:ring-primary transition-colors disabled:opacity-60"})},a)),e.jsx("td",{className:"px-2 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:p,disabled:m.isPending,className:"h-8 w-8 rounded-md flex items-center justify-center text-primary hover:bg-primary/10 transition-colors",children:e.jsx(G,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>o(!1),className:"h-8 w-8 rounded-md flex items-center justify-center text-muted-foreground hover:bg-muted transition-colors",children:e.jsx(v,{className:"w-3.5 h-3.5"})})]})})]}),C.length===0&&!k&&e.jsx("tr",{children:e.jsx("td",{colSpan:r.length+2,className:"py-16 text-center text-muted-foreground text-sm",children:l?"Arama sonucu bulunamadı":"Henüz kayıt yok"})}),C.map((s,a)=>{const t=u.indexOf(s),f=D===t;return e.jsxs("tr",{className:"border-b border-border/40 hover:bg-muted/20 group transition-colors",children:[e.jsx("td",{className:"px-3 py-2.5 text-[11px] text-muted-foreground/50",children:t+1}),r.map((Y,S)=>e.jsx("td",{className:"px-3 py-2.5 text-[13px] text-foreground",children:String(s[S]??"")},S)),e.jsx("td",{className:"px-2 py-2 text-right",children:f?e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:()=>j.mutate(t),disabled:j.isPending,className:"px-2 py-1 text-[10px] font-bold text-white bg-red-600 hover:bg-red-700 rounded transition-colors disabled:opacity-60",children:j.isPending?"…":"Sil"}),e.jsx("button",{onClick:()=>b(null),className:"p-1 rounded hover:bg-muted transition-colors text-muted-foreground",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("button",{onClick:()=>b(t),className:"opacity-0 group-hover:opacity-100 p-1.5 rounded hover:bg-red-100 hover:text-red-600 transition-all text-muted-foreground",title:"Sil",children:e.jsx(z,{className:"w-3.5 h-3.5"})})})]},t)})]})]})})]})}export{I as default};
