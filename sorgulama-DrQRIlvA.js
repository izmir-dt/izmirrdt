import{c as G,r as o,a as I,j as e,S as j,X as C}from"./index-BiS_08CB.js";import{p as H,g as Q,c as U}from"./theater-BlRsLV9p.js";import{S as V}from"./skeleton-CIwMLOW5.js";import{I as S}from"./input-D4NQlLM0.js";import{B as X}from"./button-DjGbwvRU.js";import{P as Y}from"./page-header-DYGn4VLB.js";import{C as J,D as Z}from"./download-DUYADPWz.js";const L=G("GitMerge",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]]);const _=G("SearchCode",[["path",{d:"m13 13.5 2-2.5-2-2.5",key:"1rvxrh"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}],["path",{d:"M9 8.5 7 11l2 2.5",key:"6ffwbx"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function T({label:c,value:x,onChange:m,plays:b,accentColor:p}){const[w,d]=o.useState(!1),v=o.useMemo(()=>x?b.filter(r=>r.toLowerCase().includes(x.toLowerCase())).slice(0,12):b.slice(0,12),[b,x]);return e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider mb-1.5 block",style:{color:p},children:c}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(S,{className:"pl-9 pr-8",placeholder:"Oyun adı...",value:x,onChange:r=>{m(r.target.value),d(!0)},onFocus:()=>d(!0),onBlur:()=>setTimeout(()=>d(!1),150),style:{borderColor:x?p+"60":void 0}}),x&&e.jsx("button",{className:"absolute right-2.5 top-1/2 -translate-y-1/2",onClick:()=>m(""),children:e.jsx(C,{className:"w-3.5 h-3.5 text-muted-foreground"})})]}),w&&v.length>0&&e.jsx("div",{className:"absolute z-20 top-full mt-1 left-0 right-0 bg-popover border border-border rounded-lg shadow-xl overflow-hidden max-h-52 overflow-y-auto",children:v.map(r=>e.jsx("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-muted transition-colors truncate",onMouseDown:()=>{m(r),d(!1)},children:r},r))})]})}function ne(){const[c,x]=o.useState("kesisim"),[m,b]=o.useState(""),[p,w]=o.useState(""),[d,v]=o.useState(""),[r,K]=o.useState(""),[n,z]=o.useState(""),[M,$]=o.useState(!1),{data:k,isLoading:P}=I({queryKey:["/api/sheets","BÜTÜN OYUNLAR"],refetchOnMount:"always"}),g=o.useMemo(()=>k?H(k.headers,k.rows):[],[k]),F=o.useMemo(()=>Q(g).map(s=>s.name),[g]),f=o.useMemo(()=>g.filter(s=>!(m&&!s.kategori.toLowerCase().includes(m.toLowerCase())||p&&!s.oyun.toLowerCase().includes(p.toLowerCase())||d&&!s.kisi.toLowerCase().includes(d.toLowerCase()))),[g,m,p,d]),A=m||p||d,l=o.useMemo(()=>{if(!r||!n)return null;const s=g.filter(t=>t.oyun===r),a=g.filter(t=>t.oyun===n),i=new Map,y=new Map;s.forEach(t=>{t.kisi.split(",").forEach(u=>{const h=u.trim();if(!h)return;i.has(h)||i.set(h,[]);const N=i.get(h);t.gorev.trim()&&!N.includes(t.gorev.trim())&&N.push(t.gorev.trim())})}),a.forEach(t=>{t.kisi.split(",").forEach(u=>{const h=u.trim();if(!h)return;y.has(h)||y.set(h,[]);const N=y.get(h);t.gorev.trim()&&!N.includes(t.gorev.trim())&&N.push(t.gorev.trim())})});const B=new Set(i.keys()),O=new Set(y.keys()),R=[...B].filter(t=>!O.has(t)).sort((t,u)=>t.localeCompare(u,"tr")).map(t=>({name:t,gorev:(i.get(t)||[]).join(", ")})),D=[...O].filter(t=>!B.has(t)).sort((t,u)=>t.localeCompare(u,"tr")).map(t=>({name:t,gorev:(y.get(t)||[]).join(", ")})),q=[...B].filter(t=>O.has(t)).sort((t,u)=>t.localeCompare(u,"tr")).map(t=>({name:t,gorevA:(i.get(t)||[]).join(", "),gorevB:(y.get(t)||[]).join(", ")}));return{onlyA:R,onlyB:D,common:q}},[g,r,n]),E=o.useMemo(()=>{if(c==="filtre"){const s="Oyun	Kategori	Görev	Kişi",a=f.map(i=>`${i.oyun}	${i.kategori}	${i.gorev}	${i.kisi}`);return[s,...a].join(`
`)}else if(c==="kesisim"&&l){const s=["Durum	Kişi	Görev (A)	Görev (B)"];return l.common.forEach(a=>s.push(`Ortak	${a.name}	${a.gorevA}	${a.gorevB}`)),l.onlyA.forEach(a=>s.push(`Sadece ${r}	${a.name}	${a.gorev}	`)),l.onlyB.forEach(a=>s.push(`Sadece ${n}	${a.name}		${a.gorev}`)),s.join(`
`)}return""},[c,f,l,r,n]),W=()=>{E&&navigator.clipboard.writeText(E).then(()=>{$(!0),setTimeout(()=>$(!1),2e3)})};return P?e.jsx("div",{className:"p-6",children:e.jsx(V,{className:"h-64 rounded-xl"})}):e.jsxs("div",{className:"p-6 space-y-5 max-w-5xl",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(Y,{icon:_,title:"Sorgulama",description:"Personel, oyun ve kategoriye göre filtrele — ya da iki oyunun ortak personelini karşılaştır"}),e.jsxs("button",{"data-testid":"button-excel-sorgulama",onClick:W,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold border transition-all shrink-0 mt-1",style:{background:"hsl(var(--card))",color:"hsl(var(--muted-foreground))",borderColor:"hsl(var(--border))"},children:[M?e.jsx(J,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(Z,{className:"w-3.5 h-3.5"}),M?"Kopyalandı!":"Excel'e Kopyala"]})]}),e.jsxs("div",{className:"flex gap-1 bg-muted/40 rounded-xl p-1 w-fit",children:[e.jsxs("button",{"data-testid":"tab-kesisim",onClick:()=>x("kesisim"),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-semibold transition-all",style:c==="kesisim"?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))"}:{color:"hsl(var(--muted-foreground))"},children:[e.jsx(L,{className:"w-3.5 h-3.5"}),"Kesişim Analizi"]}),e.jsxs("button",{"data-testid":"tab-filtre",onClick:()=>x("filtre"),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-semibold transition-all",style:c==="filtre"?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))"}:{color:"hsl(var(--muted-foreground))"},children:[e.jsx(j,{className:"w-3.5 h-3.5"}),"Filtrele"]})]}),c==="filtre"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card border border-card-border rounded-xl p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Filtreler"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"— birden fazla alanı doldurunca hepsi birlikte uygulanır"})]}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-muted-foreground mb-1.5 block",children:["Kategori",e.jsx("span",{className:"font-normal ml-1 text-[10px]",children:"— ör: Oyuncu, Figüran"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(S,{"data-testid":"input-filter-gorev",className:"pl-9",placeholder:"Kategori...",value:m,onChange:s=>b(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-muted-foreground mb-1.5 block",children:["Oyun",e.jsx("span",{className:"font-normal ml-1 text-[10px]",children:"— ör: Anahtar"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(S,{"data-testid":"input-filter-oyun",className:"pl-9",placeholder:"Oyun adı...",value:p,onChange:s=>w(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-semibold text-muted-foreground mb-1.5 block",children:["Kişi",e.jsx("span",{className:"font-normal ml-1 text-[10px]",children:"— ör: Öztürk"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(S,{"data-testid":"input-filter-kisi",className:"pl-9",placeholder:"Kişi adı...",value:d,onChange:s=>v(s.target.value)})]})]})]}),A&&e.jsxs(X,{variant:"ghost",size:"sm",className:"mt-3 text-muted-foreground",onClick:()=>{b(""),w(""),v("")},children:[e.jsx(C,{className:"w-3.5 h-3.5 mr-1"})," Temizle"]})]}),e.jsxs("div",{className:"bg-card border border-card-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Sonuçlar"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:A?`${f.length} satır`:"Filtre girerek başlayın"})]}),A?f.length===0?e.jsxs("div",{className:"py-16 text-center text-muted-foreground",children:[e.jsx(C,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Sonuç bulunamadı"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"text-left px-5 py-2.5 text-xs font-semibold text-muted-foreground",children:"Kişi"}),e.jsx("th",{className:"text-left px-3 py-2.5 text-xs font-semibold text-muted-foreground",children:"Görev"}),e.jsx("th",{className:"text-left px-3 py-2.5 text-xs font-semibold text-muted-foreground",children:"Kategori"}),e.jsx("th",{className:"text-left px-3 py-2.5 text-xs font-semibold text-muted-foreground",children:"Oyun"})]})}),e.jsxs("tbody",{children:[f.slice(0,300).map((s,a)=>e.jsxs("tr",{className:"border-t border-border/50 hover:bg-muted/20",children:[e.jsx("td",{className:"px-5 py-2 font-medium text-foreground text-xs whitespace-nowrap",children:s.kisi}),e.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground",children:s.gorev}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-medium ${U(s.kategori)}`,children:s.kategori})}),e.jsx("td",{className:"px-3 py-2 text-xs text-muted-foreground max-w-[200px] truncate",children:s.oyun})]},a)),f.length>300&&e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"px-5 py-3 text-xs text-center text-muted-foreground",children:["+ ",f.length-300," daha fazla satır"]})})]})]})}):e.jsxs("div",{className:"py-16 text-center text-muted-foreground",children:[e.jsx(j,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm font-medium",children:"Filtre girin"}),e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"Kategori, oyun veya kişi alanlarından birini doldurun"})]})]})]}),c==="kesisim"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card border border-card-border rounded-xl p-5",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"İki oyun seçin — aynı kişilerin her iki oyunda da görev alıp almadığını görün"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-5",children:[e.jsx(T,{label:"1. Oyun",value:r,onChange:K,plays:F,accentColor:"hsl(220, 80%, 45%)"}),e.jsx(T,{label:"2. Oyun",value:n,onChange:z,plays:F,accentColor:"hsl(340, 75%, 45%)"})]}),(r||n)&&e.jsxs("button",{onClick:()=>{K(""),z("")},className:"mt-3 text-xs text-muted-foreground hover:text-foreground flex items-center gap-1 transition-colors",children:[e.jsx(C,{className:"w-3 h-3"})," Temizle"]})]}),!r||!n?e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(L,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm font-medium",children:"İki oyun seçin"}),e.jsx("p",{className:"text-xs mt-1 opacity-70",children:"Ortak personel listesi burada görünecek"})]}):l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card border border-card-border rounded-xl py-4 px-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{background:"rgba(37,99,235,0.7)"}}),e.jsx("p",{className:"text-[11px] font-bold leading-tight break-words",style:{color:"hsl(220, 80%, 45%)"},children:r})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end text-right",children:[e.jsx("p",{className:"text-[11px] font-bold leading-tight break-words",style:{color:"hsl(340, 75%, 45%)"},children:n}),e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{background:"rgba(220,38,127,0.7)"}})]})]}),e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsxs("svg",{viewBox:"0 0 400 150",className:"w-full max-w-[400px]",children:[e.jsx("circle",{cx:"140",cy:"75",r:"65",fill:"rgba(37,99,235,0.13)",stroke:"rgba(37,99,235,0.65)",strokeWidth:"2"}),e.jsx("circle",{cx:"260",cy:"75",r:"65",fill:"rgba(220,38,127,0.10)",stroke:"rgba(220,38,127,0.65)",strokeWidth:"2"}),e.jsx("text",{x:"90",y:"68",textAnchor:"middle",fontSize:"32",fontWeight:"800",fill:"rgb(37,99,235)",children:l.onlyA.length}),e.jsx("text",{x:"90",y:"88",textAnchor:"middle",fontSize:"11",fill:"rgb(37,99,235)",opacity:"0.85",fontWeight:"600",children:"sadece A"}),e.jsx("text",{x:"200",y:"68",textAnchor:"middle",fontSize:"28",fontWeight:"800",fill:"rgb(100,48,210)",children:l.common.length}),e.jsx("text",{x:"200",y:"86",textAnchor:"middle",fontSize:"11",fill:"rgb(100,48,210)",opacity:"0.85",fontWeight:"600",children:"ortak"}),e.jsx("text",{x:"310",y:"68",textAnchor:"middle",fontSize:"32",fontWeight:"800",fill:"rgb(220,38,127)",children:l.onlyB.length}),e.jsx("text",{x:"310",y:"88",textAnchor:"middle",fontSize:"11",fill:"rgb(220,38,127)",opacity:"0.85",fontWeight:"600",children:"sadece B"})]})})]}),e.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card border rounded-xl overflow-hidden",style:{borderColor:"hsl(220 80% 50% / 0.3)"},children:[e.jsxs("div",{className:"px-4 py-3 border-b",style:{background:"hsl(220 80% 58% / 0.10)",borderColor:"hsl(220 80% 50% / 0.2)"},children:[e.jsxs("p",{className:"text-[10px] font-bold uppercase tracking-wider",style:{color:"hsl(220 80% 45%)"},children:["Sadece ",r.length>20?r.slice(0,18)+"…":r]}),e.jsx("p",{className:"text-2xl font-bold text-foreground mt-0.5",children:l.onlyA.length})]}),e.jsx("div",{className:"p-3 space-y-0.5 max-h-72 overflow-y-auto",children:l.onlyA.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Özgün kişi yok"}):l.onlyA.map(s=>e.jsxs("div",{className:"px-2 py-1.5 rounded hover:bg-muted/40 transition-colors",children:[e.jsx("p",{className:"text-[12px] font-semibold text-foreground leading-tight",children:s.name}),s.gorev&&e.jsx("p",{className:"text-[10px] text-muted-foreground leading-tight mt-0.5",children:s.gorev})]},s.name))})]}),e.jsxs("div",{className:"bg-card border rounded-xl overflow-hidden",style:{borderColor:"hsl(var(--sidebar-primary) / 0.3)"},children:[e.jsxs("div",{className:"px-4 py-3 border-b",style:{background:"hsl(var(--sidebar-primary) / 0.08)",borderColor:"hsl(var(--sidebar-primary) / 0.2)"},children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider",style:{color:"hsl(var(--sidebar-primary))"},children:"Ortak Kişiler"}),e.jsx("p",{className:"text-2xl font-bold text-foreground mt-0.5",children:l.common.length})]}),e.jsx("div",{className:"p-3 space-y-0.5 max-h-72 overflow-y-auto",children:l.common.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Ortak kişi yok"}):l.common.map(s=>e.jsxs("div",{className:"px-2 py-1.5 rounded transition-colors",style:{background:"hsl(var(--sidebar-primary) / 0.06)"},children:[e.jsx("p",{className:"text-[12px] font-semibold text-foreground leading-tight",children:s.name}),e.jsxs("div",{className:"flex gap-2 mt-0.5 flex-wrap",children:[s.gorevA&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx("span",{className:"font-medium",style:{color:"hsl(220 80% 45%)"},children:"A:"})," ",s.gorevA]}),s.gorevB&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx("span",{className:"font-medium",style:{color:"hsl(340 75% 45%)"},children:"B:"})," ",s.gorevB]})]})]},s.name))})]}),e.jsxs("div",{className:"bg-card border rounded-xl overflow-hidden",style:{borderColor:"hsl(340 75% 50% / 0.3)"},children:[e.jsxs("div",{className:"px-4 py-3 border-b",style:{background:"hsl(340 75% 55% / 0.10)",borderColor:"hsl(340 75% 50% / 0.2)"},children:[e.jsxs("p",{className:"text-[10px] font-bold uppercase tracking-wider",style:{color:"hsl(340 75% 45%)"},children:["Sadece ",n.length>20?n.slice(0,18)+"…":n]}),e.jsx("p",{className:"text-2xl font-bold text-foreground mt-0.5",children:l.onlyB.length})]}),e.jsx("div",{className:"p-3 space-y-0.5 max-h-72 overflow-y-auto",children:l.onlyB.length===0?e.jsx("p",{className:"text-xs text-muted-foreground italic",children:"Özgün kişi yok"}):l.onlyB.map(s=>e.jsxs("div",{className:"px-2 py-1.5 rounded hover:bg-muted/40 transition-colors",children:[e.jsx("p",{className:"text-[12px] font-semibold text-foreground leading-tight",children:s.name}),s.gorev&&e.jsx("p",{className:"text-[10px] text-muted-foreground leading-tight mt-0.5",children:s.gorev})]},s.name))})]})]})]})]})]})}export{ne as default};
