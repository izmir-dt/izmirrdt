import{u as w,r as o,a as R,j as e,S as A,X as L}from"./index-BiS_08CB.js";import{p as P,t as b,i as T,c as K}from"./theater-BlRsLV9p.js";import{S as y}from"./skeleton-CIwMLOW5.js";import{I as O}from"./input-D4NQlLM0.js";import{C as U}from"./chevron-left-aY-Dd53K.js";import{U as $}from"./users-B7ucXcX7.js";import{T as I}from"./theater-CXqowHoh.js";import{B as D}from"./baby-DmBnwbxH.js";function z({personName:j,rows:c,onBack:i}){const[,p]=w(),d=o.useMemo(()=>{const a=new Map;return c.forEach(n=>{a.has(n.oyun)||a.set(n.oyun,[]),a.get(n.oyun).push(n)}),a},[c]),g=o.useMemo(()=>Array.from(d.keys()).sort((a,n)=>a.localeCompare(n,"tr")),[d]),m=o.useMemo(()=>{const a=new Set;return c.forEach(n=>{n.gorev.trim()&&a.add(n.gorev.trim())}),Array.from(a).sort((n,f)=>n.localeCompare(f,"tr"))},[c]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-b border-border",style:{background:"hsl(var(--card))"},children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{onClick:i,className:"p-1 rounded-lg hover:bg-muted transition-colors text-muted-foreground",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"font-bold text-[14px] text-foreground",children:j}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:[g.length," oyun  ·  ",c.length," kayıt",m.length>0&&e.jsxs("span",{className:"hidden sm:inline",children:["  ·  ",m.slice(0,2).join(", "),m.length>2?"…":""]})]})]})]}),e.jsxs("button",{onClick:()=>p(`/dagilim?kisi=${encodeURIComponent(j)}`),className:"text-xs font-semibold px-2.5 py-1 rounded-lg border border-border hover:bg-muted transition-colors text-muted-foreground hidden sm:flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Dağılım"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3",children:g.map(a=>{const n=d.get(a),f=T(a);return e.jsxs("div",{className:"rounded-xl border border-border overflow-hidden",style:{background:"hsl(var(--card))"},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-border",style:{background:"hsl(var(--sidebar) / 0.5)"},children:[e.jsx(I,{className:"w-3 h-3 shrink-0",style:{color:"hsl(var(--sidebar-primary))"}}),e.jsx("span",{className:"font-bold text-[12px] text-foreground flex-1 cursor-pointer hover:underline",onClick:()=>p(`/?oyun=${encodeURIComponent(a)}`),title:"Oyuna git",children:a}),f&&e.jsxs("span",{className:"text-[10px] font-semibold text-chart-4 bg-chart-4/10 px-1.5 py-0.5 rounded flex items-center gap-0.5",children:[e.jsx(D,{className:"w-2.5 h-2.5"}),"Ç.O"]})]}),e.jsx("div",{className:"px-3 py-2 space-y-1",children:n.map((u,v)=>e.jsxs("div",{className:"flex items-start gap-2 py-0.5",children:[e.jsx("span",{className:`shrink-0 text-[10px] font-semibold px-1.5 py-0.5 rounded mt-0.5 ${K(u.kategori)}`,children:u.kategori}),e.jsx("span",{className:"text-[12px] text-muted-foreground leading-snug",children:u.gorev||"—"})]},v))})]},a)})})]})}function J(){const[j]=w(),c=o.useMemo(()=>typeof window>"u"?"":new URLSearchParams(window.location.search).get("kisi")||"",[j]),[i,p]=o.useState(null),[d,g]=o.useState(""),[m,a]=o.useState("all"),[n,f]=o.useState("list"),{data:u,isLoading:v}=R({queryKey:["/api/sheets","BÜTÜN OYUNLAR"],refetchOnMount:"always"}),x=o.useMemo(()=>u?P(u.headers,u.rows):[],[u]),h=o.useMemo(()=>{const s=new Map;return x.forEach(r=>{r.kisi.split(",").map(l=>l.trim()).filter(Boolean).forEach(l=>{s.has(l)||s.set(l,{plays:new Set,rows:[]});const k=s.get(l);k.plays.add(r.oyun),k.rows.push(r)})}),Array.from(s.entries()).map(([r,{plays:t,rows:l}])=>({name:r,playCount:t.size,plays:t,rows:l})).sort((r,t)=>r.name.localeCompare(t.name,"tr"))},[x]);o.useEffect(()=>{if(c&&h.length>0){const s=h.find(r=>r.name===c);s&&(p(s.name),f("detail"))}},[c,h]);const C=o.useMemo(()=>{const s=new Map;return x.forEach(r=>{const t=r.kategori.trim();t&&s.set(t,(s.get(t)||0)+1)}),Array.from(s.entries()).sort((r,t)=>t[1]-r[1]).slice(0,6).map(([r])=>r)},[x]),N=o.useMemo(()=>{let s=h;if(m!=="all"&&(s=s.filter(r=>r.rows.some(t=>t.kategori.trim()===m))),d.trim()){const r=b(d.trim());s=s.filter(t=>b(t.name).includes(r)||t.rows.some(l=>b(l.gorev).includes(r)||b(l.oyun).includes(r)||b(l.kategori).includes(r)))}return s},[h,d,m]),M=o.useMemo(()=>i&&h.find(s=>s.name===i)||null,[h,i]),S=o.useMemo(()=>i?x.filter(s=>s.kisi.split(",").some(r=>r.trim()===i)):[],[x,i]),E=o.useCallback(s=>{p(s),f("detail")},[]),B=o.useCallback(()=>{f("list")},[]);return v?e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-72 shrink-0 border-r p-3 space-y-2",children:[e.jsx(y,{className:"h-9 w-full rounded-lg"}),e.jsx(y,{className:"h-7 w-full rounded-lg"}),[1,2,3,4,5,6,7].map(s=>e.jsx(y,{className:"h-12 rounded-lg"},s))]}),e.jsxs("div",{className:"flex-1 p-4 space-y-3",children:[e.jsx(y,{className:"h-12 w-80 rounded-lg"}),[1,2,3,4].map(s=>e.jsx(y,{className:"h-20 rounded-xl"},s))]})]}):e.jsx("div",{className:"flex flex-col h-full overflow-hidden",children:e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:`${n==="detail"?"hidden":"flex"} md:flex flex-col w-full md:w-72 shrink-0 border-r border-border`,style:{background:"hsl(var(--card))"},children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(O,{"data-testid":"input-search-persons",placeholder:"Kişi, görev, oyun ara…",value:d,onChange:s=>g(s.target.value),className:"pl-8 pr-7 h-8 text-[12px]"}),d&&e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>g(""),children:e.jsx(L,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:["all",...C].map(s=>e.jsx("button",{onClick:()=>a(s),className:"px-2 py-0.5 text-[10px] font-bold rounded-md transition-all",style:m===s?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))"}:{background:"hsl(var(--muted)/0.5)",color:"hsl(var(--muted-foreground))"},children:s==="all"?"Tümü":s},s))}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1.5 px-0.5",children:[N.length," kişi",d&&e.jsxs("span",{className:"text-primary font-medium",children:[' · "',d,'"']})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:N.map(s=>{const r=i===s.name,t=Array.from(new Set(s.rows.map(l=>l.kategori.trim()).filter(Boolean)));return e.jsx("button",{"data-testid":`person-item-${s.name}`,onClick:()=>E(s.name),className:"w-full text-left px-3 py-2 border-b border-border/50 transition-colors flex items-center gap-2",style:r?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-foreground))"}:{background:"transparent",color:"hsl(var(--foreground))"},onMouseEnter:l=>{r||(l.currentTarget.style.background="hsl(var(--muted))")},onMouseLeave:l=>{r||(l.currentTarget.style.background="transparent")},children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-[12px] font-semibold leading-snug block truncate",style:r?{color:"hsl(var(--sidebar-foreground))"}:{},children:s.name}),e.jsxs("p",{className:"text-[10px] mt-0.5 truncate",style:r?{color:"hsl(var(--sidebar-foreground) / 0.65)"}:{color:"hsl(var(--muted-foreground))"},children:[s.playCount," oyun · ",t.slice(0,2).join(", ")]})]})},s.name)})})]}),e.jsx("div",{className:`${n==="list"?"hidden":"flex"} md:flex flex-1 flex-col min-w-0`,style:{background:"hsl(var(--background))"},children:i&&M?e.jsx(z,{personName:i,rows:S,onBack:B}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:"hsl(var(--sidebar))"},children:e.jsx("span",{className:"font-black text-xl",style:{color:"hsl(var(--sidebar-primary))"},children:"İDT"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Bir kişi seçin"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Sol panelden bir kişiyi tıklayarak",e.jsx("br",{}),"oyun ve görev listesini görüntüleyin"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3 text-xs text-muted-foreground mt-2",children:[e.jsxs("span",{className:"bg-card border border-border rounded-lg px-3 py-1.5",children:[e.jsx("strong",{className:"text-foreground",children:h.length})," Kişi"]}),e.jsxs("span",{className:"bg-card border border-border rounded-lg px-3 py-1.5",children:[e.jsx("strong",{className:"text-foreground",children:new Set(x.map(s=>s.oyun)).size})," Oyun"]}),e.jsxs("span",{className:"bg-card border border-border rounded-lg px-3 py-1.5",children:[e.jsx("strong",{className:"text-foreground",children:x.length})," Kayıt"]})]})]})})]})})}export{J as default};
