import{c as w,u as G,r as a,a as D,j as e,S as k,X as N,C as H,b as U,d as I}from"./index-BiS_08CB.js";import{p as q,a as V,i as Q}from"./theater-BlRsLV9p.js";import{S as X}from"./skeleton-CIwMLOW5.js";import{I as K}from"./input-D4NQlLM0.js";import{P as Y}from"./page-header-DYGn4VLB.js";import{D as J,C as W}from"./download-DUYADPWz.js";import{B as Z}from"./baby-DmBnwbxH.js";import{C as _}from"./copy-dkgLgat7.js";const ee=w("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const re=w("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const se=w("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);function xe(){const[C,T]=G(),x=a.useMemo(()=>typeof window>"u"?"":new URLSearchParams(window.location.search).get("kisi")||"",[C]),z=a.useMemo(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("from")==="grafik",[C]),[m,S]=a.useState(x),[A,L]=a.useState(x||null),[l,O]=a.useState(1),[M,p]=a.useState(!1),[n,b]=a.useState(""),[F,f]=a.useState(!1),[P,E]=a.useState(!1),g=a.useRef(null);a.useEffect(()=>{x&&(S(x),L(x))},[x]);const{data:y,isLoading:B}=D({queryKey:["/api/sheets","BÜTÜN OYUNLAR"],refetchOnMount:"always"}),i=a.useMemo(()=>y?q(y.headers,y.rows):[],[y]),v=a.useMemo(()=>V(i),[i]);a.useMemo(()=>{const r=new Set;return i.forEach(s=>{s.oyun.trim()&&r.add(s.oyun.trim())}),Array.from(r).sort((s,t)=>s.localeCompare(t,"tr"))},[i]);const d=a.useMemo(()=>{let r=l===1?v:v.filter(s=>s.oyunlar.length===l);if(m.trim()){const s=m.toLowerCase();r=r.filter(t=>t.name.toLowerCase().includes(s))}return n.trim()&&(r=r.filter(s=>s.oyunlar.some(t=>t.toLowerCase().includes(n.toLowerCase())))),r},[v,m,l,n]),$=a.useMemo(()=>{const r="Kişi	Oyun Sayısı	Oyunlar	Görevler	Kategoriler",s=d.map(t=>{const u=t.oyunlar.join(", "),h=Array.from(new Set(i.filter(o=>o.kisi.trim().toLowerCase()===t.name.trim().toLowerCase()).map(o=>o.gorev).filter(Boolean))).join(", "),j=Array.from(new Set(i.filter(o=>o.kisi.trim().toLowerCase()===t.name.trim().toLowerCase()).map(o=>o.kategori).filter(Boolean))).join(", ");return`${t.name}	${t.oyunlar.length}	${u}	${h}	${j}`});return[r,...s].join(`
`)},[d,i]),R=()=>{navigator.clipboard.writeText($).then(()=>{E(!0),setTimeout(()=>E(!1),2e3)}).catch(()=>{g.current?.select()})};return B?e.jsx("div",{className:"p-6 space-y-3",children:[1,2,3,4,5].map(r=>e.jsx(X,{className:"h-16 rounded-xl"},r))}):e.jsxs("div",{className:"p-6 space-y-4 max-w-5xl",children:[z&&e.jsxs("button",{"data-testid":"button-back-to-grafik",onClick:()=>T("/grafik"),className:"flex items-center gap-1.5 text-xs font-semibold transition-colors",style:{color:"hsl(var(--muted-foreground))"},onMouseEnter:r=>r.currentTarget.style.color="hsl(var(--foreground))",onMouseLeave:r=>r.currentTarget.style.color="hsl(var(--muted-foreground))",children:[e.jsx(ee,{className:"w-3.5 h-3.5"}),"Grafiklere Geri Dön"]}),e.jsx(Y,{icon:re,title:"Personel Dağılımı",description:"Her kişinin hangi oyunlarda görev aldığını gösterir"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(K,{"data-testid":"input-search-person",placeholder:"Kişi ara...",value:m,onChange:r=>S(r.target.value),className:"pl-9"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[d.length," kişi"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[l>1&&e.jsxs("span",{className:"text-[11px] font-semibold px-2 py-0.5 rounded-full",style:{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))"},children:["Tam ",l," oyun"]}),e.jsxs("button",{"data-testid":"button-excel-dagilim",onClick:()=>f(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold border transition-all",style:{background:"hsl(var(--card))",color:"hsl(var(--muted-foreground))",borderColor:"hsl(var(--border))"},children:[e.jsx(J,{className:"w-3.5 h-3.5"}),"Excel'e Kopyala"]}),e.jsxs("button",{"data-testid":"button-filter-open",onClick:()=>p(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold border transition-all",style:M||l>1||n?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))",borderColor:"hsl(var(--sidebar-primary) / 0.3)"}:{background:"hsl(var(--card))",color:"hsl(var(--muted-foreground))",borderColor:"hsl(var(--border))"},children:[e.jsx(se,{className:"w-3.5 h-3.5"}),"Filtrele"]})]})]}),M&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>p(!1),children:e.jsxs("div",{className:"absolute right-0 top-0 h-full w-72 shadow-2xl flex flex-col",style:{background:"hsl(var(--card))",borderLeft:"1px solid hsl(var(--border))"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-border shrink-0",children:[e.jsx("h3",{className:"text-sm font-bold text-foreground",children:"Filtreler"}),e.jsx("button",{onClick:()=>p(!1),className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(N,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-bold uppercase tracking-wider text-muted-foreground mb-3",children:"Oyun Sayısı (Tam Eşleşme)"}),e.jsx("div",{className:"grid grid-cols-5 gap-1.5",children:[1,2,3,4,5,6,7,8,9,10].map(r=>e.jsx("button",{"data-testid":`btn-min-plays-${r}`,onClick:()=>O(r),className:"h-9 rounded-lg text-sm font-bold transition-all duration-150 border",style:l===r?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))",borderColor:"hsl(var(--sidebar-primary) / 0.4)"}:{background:"hsl(var(--muted) / 0.5)",color:"hsl(var(--muted-foreground))",borderColor:"hsl(var(--border))"},children:r===1?"1+":r},r))}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-2",children:l===1?"1 veya daha fazla oyunda görev alan kişiler":`Tam olarak ${l} oyunda görev alan kişiler`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-bold uppercase tracking-wider text-muted-foreground mb-3",children:"Oyuna Göre Filtrele"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(K,{"data-testid":"input-filter-oyun-dagilim",placeholder:"Oyun adı...",value:n,onChange:r=>b(r.target.value),className:"pl-9 h-9 text-sm"}),n&&e.jsx("button",{onClick:()=>b(""),className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(N,{className:"w-3 h-3"})})]}),n&&e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-1.5",children:['"',n,'" oyununda görev alan kişiler']})]})]}),e.jsx("div",{className:"px-5 py-4 border-t border-border shrink-0",children:e.jsx("button",{onClick:()=>{O(1),b(""),p(!1)},className:"w-full py-2 rounded-lg text-sm font-semibold border border-border text-muted-foreground hover:bg-muted/50 transition-colors",children:"Filtreleri Temizle"})})]})}),e.jsxs("div",{className:"space-y-2",children:[d.length===0&&e.jsxs("div",{className:"text-center py-16 text-muted-foreground",children:[e.jsx(k,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Sonuç bulunamadı"})]}),d.map(r=>{const s=A===r.name,t=r.oyunlar.length>1;return e.jsxs("div",{className:"bg-card border border-card-border rounded-xl overflow-hidden",style:t?{borderLeft:"3px solid hsl(var(--sidebar-primary))"}:{},children:[e.jsxs("button",{"data-testid":`person-${r.name}`,className:"w-full flex items-center gap-4 px-5 py-3.5 text-left hover:bg-muted/30 transition-colors",onClick:()=>L(s?null:r.name),children:[e.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center shrink-0 font-bold text-sm",style:t?{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))"}:{background:"hsl(var(--muted))",color:"hsl(var(--muted-foreground))"},children:r.oyunlar.length}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:[r.gorevler.slice(0,3).join(" · "),r.gorevler.length>3&&` +${r.gorevler.length-3}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs("span",{className:"text-[11px] font-semibold px-2 py-0.5 rounded-full bg-muted text-foreground",children:[r.oyunlar.length," oyun"]}),s?e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(U,{className:"w-4 h-4 text-muted-foreground"})]})]}),s&&e.jsxs("div",{className:"border-t px-5 py-4",style:{borderColor:"hsl(var(--border))",background:"hsl(var(--muted) / 0.3)"},children:[e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wider text-muted-foreground mb-2.5",children:"Oyunlar ve Görevler"}),e.jsx("div",{className:"space-y-1.5",children:r.oyunlar.map(u=>{const h=Q(u),j=i.filter(c=>c.oyun===u&&c.kisi.trim().toLowerCase()===r.name.trim().toLowerCase()),o=Array.from(new Set(j.map(c=>c.gorev).filter(Boolean)));return e.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 rounded-lg",style:{background:h?"hsl(var(--background))":"hsl(var(--card))",border:`1px solid ${h?"hsl(var(--chart-3) / 0.4)":"hsl(var(--border))"}`},children:[h?e.jsx(Z,{className:"w-3.5 h-3.5 text-chart-3 shrink-0"}):e.jsx(I,{className:"w-3.5 h-3.5 opacity-30 shrink-0"}),e.jsx("span",{className:"text-[12px] font-semibold truncate flex-1",style:{color:h?"hsl(var(--chart-3))":"hsl(var(--foreground))"},children:u}),o.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 shrink-0",children:o.map(c=>e.jsx("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-md",style:{background:"hsl(var(--sidebar))",color:"hsl(var(--sidebar-primary))",border:"1px solid hsl(var(--sidebar-primary) / 0.25)"},children:c},c))})]},u)})})]})]},r.name)})]}),F&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/30 backdrop-blur-[2px]",onClick:()=>f(!1)}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-full max-w-[440px] z-50 flex flex-col",style:{background:"hsl(var(--card))",borderLeft:"1px solid hsl(var(--border))",boxShadow:"-8px 0 32px hsl(0 0% 0% / 0.12)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 shrink-0",style:{background:"hsl(var(--sidebar))",borderBottom:"1px solid hsl(var(--sidebar-border))"},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-[13px]",style:{color:"hsl(var(--sidebar-foreground))"},children:"Excel'e Aktar"}),e.jsxs("p",{className:"text-[11px] mt-0.5",style:{color:"hsl(var(--sidebar-foreground) / 0.60)"},children:[d.length," kişi ",l>1?`· tam ${l} oyun`:""," ",m?`· "${m}"`:""]})]}),e.jsx("button",{onClick:()=>f(!1),className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",style:{color:"hsl(var(--sidebar-foreground) / 0.65)"},children:e.jsx(N,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"px-4 py-2 border-b border-border shrink-0 bg-muted/30",children:e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[e.jsx("strong",{className:"text-foreground",children:d.length})," kişi · Kişi, Oyun Sayısı, Oyunlar, Görevler, Kategoriler"]})}),e.jsx("div",{className:"px-4 pt-3 shrink-0",children:e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Aşağıdaki veriyi tümünü seçip kopyalayın, Excel'e yapıştırın."})}),e.jsx("div",{className:"flex-1 overflow-hidden px-4 py-2",children:e.jsx("textarea",{ref:g,readOnly:!0,value:$,onClick:()=>g.current?.select(),className:"h-full w-full text-[11px] font-mono p-3 rounded-lg border border-border bg-muted/40 focus:outline-none resize-none cursor-text",style:{userSelect:"text"}})}),e.jsxs("div",{className:"px-4 py-3 border-t border-border shrink-0 flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Ctrl+A → Ctrl+C → Excel'e yapıştır"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-border hover:bg-muted transition-colors",children:"Kapat"}),e.jsxs("button",{"data-testid":"button-copy-excel-dagilim",onClick:R,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-semibold rounded-lg text-white transition-colors",style:{background:"hsl(155 65% 38%)"},children:[P?e.jsx(W,{className:"w-3.5 h-3.5"}):e.jsx(_,{className:"w-3.5 h-3.5"}),P?"Kopyalandı":"Kopyala"]})]})]})]})]})]})}export{xe as default};
