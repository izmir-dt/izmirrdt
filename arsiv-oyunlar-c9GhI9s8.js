import{h as B,i as G,r as a,a as V,k as A,j as e,F as R,m as Y,P,S as X,X as T,C as _,b as z,T as J,l as D}from"./index-BiS_08CB.js";import{I as W}from"./input-D4NQlLM0.js";import{S as Z}from"./skeleton-CIwMLOW5.js";import{p as I,g as ee,t as y,i as se,c as te}from"./theater-BlRsLV9p.js";import{L as re,C as ae}from"./loader-circle-kQZmj9r2.js";import{T as ne}from"./theater-CXqowHoh.js";import{B as ie}from"./baby-DmBnwbxH.js";import{U as le}from"./users-B7ucXcX7.js";const o="ARŞİV OYUNLAR";function fe(){const b=B(),{toast:u}=G(),[i,C]=a.useState(""),[O,q]=a.useState(null),[L,d]=a.useState(!1),[c,j]=a.useState(["","","",""]),p=a.useRef([]),[M,N]=a.useState(null),{data:l,isLoading:U,isFetching:F}=V({queryKey:["/api/sheets",o],staleTime:3e4}),K=l?.rows??[];l?.headers;const x=a.useMemo(()=>l?I(l.headers,l.rows):[],[l]),h=a.useMemo(()=>ee(x),[x]),S=a.useMemo(()=>{if(!i.trim())return h;const s=y(i.trim());return h.filter(t=>y(t.name).includes(s)||x.filter(r=>r.oyun===t.name).some(r=>y(r.kisi).includes(s)||y(r.gorev).includes(s)))},[h,x,i]),m=A({mutationFn:s=>D("POST",`/api/sheets/${encodeURIComponent(o)}/row`,{values:s}),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/sheets",o]}),d(!1),j(["","","",""]),u({title:"Kayıt eklendi"})},onError:()=>u({title:"Hata",description:"Kayıt eklenemedi",variant:"destructive"})}),v=A({mutationFn:s=>D("DELETE",`/api/sheets/${encodeURIComponent(o)}/row/${s}`),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/sheets",o]}),N(null),u({title:"Kayıt silindi"})},onError:()=>u({title:"Hata",description:"Kayıt silinemedi",variant:"destructive"})}),f=a.useCallback(()=>{if(!c.some(s=>s.trim())){d(!1);return}m.mutate(c)},[c,m]),Q=a.useCallback((s,t)=>{if(s.key==="Tab"){s.preventDefault();const r=s.shiftKey?t-1:t+1;r>=0&&r<4?p.current[r]?.focus():r>=4&&f()}s.key==="Enter"&&(t<3?p.current[t+1]?.focus():f()),s.key==="Escape"&&d(!1)},[f]);if(U)return e.jsx("div",{className:"p-6 space-y-3 max-w-4xl",children:[1,2,3,4].map(s=>e.jsx(Z,{className:"h-20 rounded-xl"},s))});const $=["Oyun Adı","Kategori","Görev","Kişi"];return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"shrink-0 flex items-center justify-between px-4 py-3 border-b border-border",style:{background:"hsl(var(--card))"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4",style:{color:"hsl(var(--sidebar-primary))"}}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-[14px] text-foreground",children:"Arşiv Oyunlar"}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:[h.length," oyun · ",K.length," kayıt"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b.invalidateQueries({queryKey:["/api/sheets",o]}),className:"p-1.5 rounded-lg hover:bg-muted transition-colors text-muted-foreground",title:"Yenile",children:e.jsx(Y,{className:`w-3.5 h-3.5 ${F?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>{j(["","","",""]),d(!0),setTimeout(()=>p.current[0]?.focus(),50)},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[12px] font-semibold text-white transition-colors",style:{background:"hsl(var(--sidebar))"},children:[e.jsx(P,{className:"w-3.5 h-3.5",style:{color:"hsl(var(--sidebar-primary))"}}),"Kayıt Ekle"]})]})]}),e.jsx("div",{className:"shrink-0 px-4 py-2 border-b border-border",style:{background:"hsl(var(--card))"},children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(X,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(W,{placeholder:"Oyun, kişi, görev ara…",value:i,onChange:s=>C(s.target.value),className:"pl-8 pr-7 h-8 text-[12px]"}),i&&e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>C(""),children:e.jsx(T,{className:"w-3 h-3"})})]})}),L&&e.jsxs("div",{className:"shrink-0 px-4 py-3 border-b-2 border-primary/30",style:{background:"hsl(var(--primary) / 0.04)"},children:[e.jsxs("p",{className:"text-[11px] font-semibold text-primary mb-2 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"})," Yeni Kayıt Ekle"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:$.map((s,t)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] text-muted-foreground mb-0.5",children:s}),e.jsx("input",{ref:r=>{p.current[t]=r},value:c[t],onChange:r=>{const g=[...c];g[t]=r.target.value,j(g)},onKeyDown:r=>Q(r,t),placeholder:s,disabled:m.isPending,className:"w-full h-8 px-2 rounded-md border border-primary/40 bg-background text-sm focus:outline-none focus:ring-1 focus:ring-primary transition-colors disabled:opacity-60"})]},t))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("button",{onClick:f,disabled:m.isPending,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[12px] font-semibold text-white transition-colors disabled:opacity-60",style:{background:"hsl(var(--sidebar))"},children:[m.isPending?e.jsx(re,{className:"w-3 h-3 animate-spin"}):e.jsx(ae,{className:"w-3 h-3"}),"Kaydet"]}),e.jsx("button",{onClick:()=>d(!1),className:"px-3 py-1.5 rounded-lg text-[12px] font-semibold border border-border hover:bg-muted transition-colors",children:"İptal"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[S.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-muted-foreground gap-2",children:[e.jsx(R,{className:"w-10 h-10 opacity-20"}),e.jsx("p",{className:"text-sm font-medium",children:i?"Arama sonucu bulunamadı":"Arşiv boş"}),!i&&e.jsx("p",{className:"text-xs",children:'Kayıt eklemek için "Kayıt Ekle" butonunu kullanın'})]}),S.map(s=>{const t=O===s.name,r=x.filter(n=>n.oyun===s.name),g=se(s.name);return e.jsxs("div",{className:"rounded-xl border border-border overflow-hidden",style:{background:"hsl(var(--card))"},children:[e.jsx("div",{className:"flex items-center gap-3 px-4 py-3",children:e.jsxs("button",{className:"flex-1 flex items-center gap-3 text-left",onClick:()=>q(t?null:s.name),children:[e.jsx(ne,{className:"w-4 h-4 shrink-0 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-[13px] text-foreground",children:s.name}),g&&e.jsxs("span",{className:"flex items-center gap-0.5 text-[10px] font-semibold text-chart-4 bg-chart-4/10 px-1.5 py-0.5 rounded",children:[e.jsx(ie,{className:"w-2.5 h-2.5"}),"Ç.O"]})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(le,{className:"w-2.5 h-2.5"}),s.personelCount," kişi"]}),e.jsxs("span",{children:[s.rowCount," kayıt"]})]})]}),t?e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(z,{className:"w-4 h-4 text-muted-foreground"})]})}),t&&e.jsx("div",{className:"border-t border-border",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/40",children:[e.jsx("th",{className:"w-10 px-3 py-2 text-left text-[10px] text-muted-foreground",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-semibold text-muted-foreground",children:"Kişi"}),e.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-semibold text-muted-foreground",children:"Görev"}),e.jsx("th",{className:"px-3 py-2 text-left text-[10px] font-semibold text-muted-foreground",children:"Kategori"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{children:r.map((n,E)=>{const k=K.findIndex(w=>String(w[0])===n.oyun&&String(w[2])===n.gorev&&String(w[3])===n.kisi),H=M===k;return e.jsxs("tr",{className:"border-t border-border/50 hover:bg-muted/20 group transition-colors",children:[e.jsx("td",{className:"px-3 py-2 text-muted-foreground/50",children:E+1}),e.jsx("td",{className:"px-3 py-2 font-medium text-foreground",children:n.kisi}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground",children:n.gorev}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-medium whitespace-nowrap ${te(n.kategori)}`,children:n.kategori})}),e.jsx("td",{className:"px-2 py-2 text-right",children:H?e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx("button",{onClick:()=>v.mutate(k),disabled:v.isPending,className:"px-2 py-0.5 text-[10px] font-bold text-white bg-red-600 hover:bg-red-700 rounded transition-colors disabled:opacity-60",children:v.isPending?"…":"Sil"}),e.jsx("button",{onClick:()=>N(null),className:"p-1 rounded hover:bg-muted transition-colors text-muted-foreground",children:e.jsx(T,{className:"w-3 h-3"})})]}):e.jsx("button",{onClick:()=>N(k),className:"opacity-0 group-hover:opacity-100 p-1.5 rounded hover:bg-red-100 hover:text-red-600 transition-all text-muted-foreground",title:"Sil",children:e.jsx(J,{className:"w-3 h-3"})})})]},E)})})]})})]},s.name)})]})]})}export{fe as default};
